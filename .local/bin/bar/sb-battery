#!/bin/sh

# Prints all batteries, their percentage remaining and an emoji corresponding
# to charge status (ğŸ”Œ for plugged up, ğŸ”‹ for discharging on battery, etc.).
# some icons ï– ï¥‹ï– ï–„ ï–‚ ï•¸ ï–‡ ï–


# Loop through all attached batteries and format the info
for battery in /sys/class/power_supply/BAT?*; do
    # If non-first battery, print a space separator.
    [ -n "${capacity+x}" ] && printf " "
    # Sets up the status and capacity
    case "$(cat "$battery/status")" in
      "Full") status="ïƒ§" ;;
      "Discharging") status="ïƒ§ï…†" ;;
      "Charging") status="ï‡¦ ïƒ¾" ;;
      "Not charging") status="ï„‘" ;;
      "Unknown") status="ï‡¦ ïƒ½" ;;
    esac
    capacity=$(cat "$battery/capacity")
    remaining=$(acpi | grep 'Battery 0: [DC]' | awk -F ' ' '{print $5}' | cut -c -5)

    if [[ -n $remaining ]]; then
        # printf "%s %d%% [%s]" "$status" "$capacity" "$remaining"
        echo -n "%{F#4dc0ae}$status%{F-} $capacity% [$remaining]"
    else
        # printf "%s %d%%" "$status" "$capacity"
        echo -n "%{F#4dc0ae}$status%{F-} $capacity%"
    fi

    # if [[ "$capacity" <= "10" ]] && [[ $status = "ïƒ§ï…†" ]]; then
    #     # printf "%s%s" "$status" " î€‰"
    #     notify-send "$status Charging!!!" "Battery is $capacity%" -u critical -i "/usr/share/icons/Paper/22x22/panel/battery-low.svg"
    # else
    #     # printf "%s" "$status"
    #     # printf "%s %d%%" "$status" "$capacity"
    #     exit 1
    # fi

# if [[ "$capacity" -le "10" ]]; then
#     blink=$(date +%s);
#     if [ $((blink % 2)) -eq 0 ]; then
#         printf "%s%s" "$status" "î€‰"
#     else
#         printf "%s" "$status"
#     fi
# fi
# printf "%s" "$(if [[ $capacity -lt 10]]; then blink=$(date +%s) if [ $((blink % 2)) -eq 0 ]; then printf "%s%s" "$status" "î€‰"; else printf "%s" "$status"; fi else printf "%s" "" fi)"

done && exit 0
